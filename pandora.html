<head>
  <title>Pandora</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<template name="base">
	<div class="page-wrapper">
		<div class="contents contents-{{yp}}">
			{{> yield}}
		</div>
	</div>
</template>

<template name="navbar">
	<nav class="navbar navbar-default navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">Pandora</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
				{{#if eq navbarActive "home"}}
        <li class="active"><a href="/">Home <span class="sr-only">(current)</span></a></li>
				{{else}}
				<li><a href="/">Home</a></li>
				{{/if}}
				{{#if admin}}
					{{#if eq navbarActive "admin"}}
						<li class="active"><a href="/admin/users">Admin</a></li>
					{{else}}
						<li><a href="/admin/users">Admin</a></li>
					{{/if}}
				{{/if}}
			</ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">{{username}} <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/settings">Settings</a></li>
            <li><a href="#" class="logout">Logout</a></li>
          </ul>
        </li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div>
	</nav>
</template>

<template name="settings">
	{{>navbar}}
	<div class="container">
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Change Password</h3>
			</div>
			<div class="panel-body">
				<div class="form-group">
					<label>Current Password</label>
					<input type="password" class="form-control current-password">
				</div>
				<div class="form-group">
					<label>New Password</label>
					<input type="password" class="form-control new-password">
				</div>
				<div class="form-group">
					<label>Confirm New Password</label>
					<input type="password" class="form-control confirm-password">
				</div>
				{{#if error}}
					<div class="error-msg">
						<strong class="text-danger">{{error}}</strong>
					</div>
				{{/if}}
				{{#if success}}
					<div class="error-msg">
						<strong class="text-success">{{success}}</strong>
					</div>	
				{{/if}}
				<button class="btn btn-primary change-password">Update Password</button>
			</div>
		</div>
	</div>
</template>

<template name="home">
	{{>navbar}}
	<div class="container container-f">
		<div class="col-md-2">
			<div class="list-group bit-g">
				{{#if admin}}
					{{#if eq active2 "0"}}
						<a class="list-group-item active" href="/">My Courses</a>
					{{else}}
						<a class="list-group-item" href="/">My Courses</a>	
					{{/if}}
					{{else}}
					{{#if eq active2 "0"}}
						<a class="list-group-item active" href="/">My Courses</a>
					{{else}}
						<a class="list-group-item" href="/">My Courses</a>
					{{/if}}
				{{/if}}
				{{#if eq active2 "1"}}
					<a class="list-group-item active" href="/subjects">Subjects</a>
				{{else}}
					<a class="list-group-item" href="/subjects">Subjects</a>
				{{/if}}
				{{#if eq active2 "2"}}
					<a class="list-group-item active" href="/clubs">Clubs</a>
				{{else}}
					<a class="list-group-item" href="/clubs">Clubs</a>
				{{/if}}
			</div>	
		</div>
		<div class="col-md-10">
			{{#each subjects}}
				{{#if eq ../active2 "2"}}
					<div class="col-md-3">
						<a href="/rooms/{{_id}}/" style="background-image: url({{GeoPattern title}});" class="icon2 icon3">
							<span class="title">{{title}}</span>	
						</a>	
						{{#if teacher _id}}
							<span class="label label-info is-teacher">My Club</span>
						{{else}}
							{{#if joined _id}}
								<button class="btn btn-sm btn-default unjoin">Unsubscribe</button>	
							{{else}}
								<button class="btn btn-sm btn-default join">Subscribe</button>
							{{/if}}
						{{/if}}
					</div>
				{{else}}
					<div class="col-md-3">
						<a href="/rooms/{{_id}}/" style="background-image: url({{GeoPattern title}});" class="icon2">
							<span class="title">{{title}}</span>	
						</a>	
					</div>
				{{/if}}
			{{/each}}
		</div>
	</div>
</template>

<template name="pagination">
	<nav class="text-center">
		<ul class="pagination">
			{{#if firstPage}}
				<li class="disabled">
					<span aria-hidden="true">&laquo;</span>
				</li>
			{{else}}
				<li>
					<a href="/admin/{{route}}?page={{prevPage}}" class="prev" aria-label="Previous">
						<span aria-hidden="true">&laquo;</span>
					</a>
				</li>
			{{/if}}
			{{#each pages}}
				{{#if isPage .}}
					<li class="active"><a href="/admin/{{../route}}?page={{.}}">{{.}}</a></li>
				{{else}}
					<li><a href="/admin/{{../route}}?page={{.}}">{{.}}</a></li>
				{{/if}}
			{{/each}}
			{{#if lastPage}}
				<li class="disabled">
					<span aria-hidden="true">&raquo;</span>
				</li>
			{{else}}
				<li>
					<a href="/admin/{{route}}?page={{nextPage}}" class="next" aria-label="Next">
						<span aria-hidden="true">&raquo;</span>
					</a>
				</li>
			{{/if}}
		</ul>
	</nav>
</template>

<template name="/admin/rooms">
	{{>navbar}}
	<div class="container">
		<div class="row">
			<div class="col-md-2">
				{{>adminNav}}
			</div>
			<div class="col-md-10">
				<div class="col-md-4 col-lg-3">
					<input type="text" class="form-control search" placeholder="Search...">
				</div>
				<div class="col-md-8 col-lg-9">
					<div class="pull-right">
						<a class="btn btn-success" href="/admin/rooms/create"><i class="fa fa-plus"></i> Add</a>
					</div>	
				</div>
				<br><br><br>
				<div class="col-md-12">
					<div class="panel panel-default users">
						<div class="panel-heading">
							<h3 class="panel-title">
								<span class="panel-sup">Rooms ({{count}})</span>
							</h3>
						</div>
						<ul class="list-group">
						{{#each rooms}}
							<li class="list-group-item">
								{{title}}
								<div class="pull-right">
									<a class="btn btn-xs btn-edit" href="/admin/rooms/{{_id}}/edit"><i class="fa fa-pencil"></i> Edit</a>
									<button class="btn btn-xs btn-danger del"><i class="fa fa-trash-o"></i> Delete</button>
								</div>
							</li>
						{{/each}}
					</ul>
				</div>
				{{> pagination route="rooms"}}
			</div>
		</div>
	</div>
</div>
</template>

<template name="navigation">
	{{>navbar}}
	<div class="cover-image">
		<div class="cover-image-container">
			<div class="cover-info">
				<div class="cover-title">{{title}}</div>
			</div>
		</div>
	</div>
	<div class="topbar">
		<div class="row">
			<div class="col-md-12">
				<nav class="text-center">
						<ul>
							{{#if isNavActive "notices"}}
								<li class="active"><a href="/rooms/{{_id}}/">Notices</a></li>
							{{else}}
								<li><a href="/rooms/{{_id}}/">Notices</a></li>
							{{/if}}
							{{#if isNavActive "files"}}
								<li class="active"><a href="/rooms/{{_id}}/files">Files</a></li>
							{{else}}
								<li><a href="/rooms/{{_id}}/files">Files</a></li>
							{{/if}}
							{{#if isNavActive "quizzes"}}
								<li class="active"><a href="/rooms/{{_id}}/quizzes">Quizzes</a></li>
							{{else}}
								<li><a href="/rooms/{{_id}}/quizzes">Quizzes</a></li>
							{{/if}}
						</ul>
					</nav>
			</div>
		</div>
	</div>
</template>	

<template name="noticeNav">
	<div class="panel panel-default">
		<div class="panel-heading">
			Upcoming
		</div>	
		{{#if eq events.length 0}}
			<div class="panel-body">
				There is nothing upcoming.
			</div>
		{{/if}}
		<ul class="list-group">
			{{#each events}}
				<li class="list-group-item">	
					{{text}}<br>	
					<span class="info">
						{{#if eq type "reminder"}}
							{{fullDate eventDate}}
						{{else}}
							Due on {{fullDate deadline}}
						{{/if}}
					</span>
				</li>
			{{/each}}
		</ul>
	</div>
	<div class="panel panel-default">
		<div class="panel-heading">
			RSS feed <i class="fa fa-rss"></i>
		</div>
		<div class="panel-body">
			<input type="text" class="form-control" readonly value="pandora.com/rss/h4jfk7">
		</div>
	</div>
</template>

<template name="notices">
	{{> navigation}}
	<div class="container">
		<div class="col-md-3">
			{{>noticeNav}}
		</div>
		<div class="col-md-9">
		<div class="super">
		<div class="col-md-12">
				{{#if teacher}}
				<div class="topbit">
					<a href="/rooms/{{_id}}/notices/announcement" class="btn btn-default">Announcement</a>
					<a href="/rooms/{{_id}}/notices/poll" class="btn btn-default">Poll</a>
					<a href="/rooms/{{_id}}/notices/reminder" class="btn btn-default">Reminder</a>
					<a href="/rooms/{{_id}}/notices/assignment" class="btn btn-default">Assignment</a>
				</div>
				{{/if}}
				</div>
				</div>
		{{#if eq notices.length 0}}
			<div class="col-md-12">
			<div class="jumbotron">
				<h2 class="text-center"><i class="fa fa-exclamation-circle fa-2x"></i></h2>
				<p class="text-center">Nothing here</p>
				<ul>
					<li>Announcements let you post information</li>
					<li>Polls let you gather class feedback</li>
					<li>Reminders let you put up important dates which is put in the students' online calendars</li>
					<li>Assignments let you set homework which is put in students' online planners</li>
					<li>Assignments can also be used to let students upload work onto Pandora for marking and grading</li>
					<li>Files let you upload resources for pupils to download</li>
					<li>Quizzes let you test students on single answer, multiple choice, checkbox and fill-in-the-gap questions</li>
					<li>Vocabulary Quizzes let students practice vocabulary</li>
				</ul>
			</div>
			</div>
		{{/if}}
		{{#each notices}}
			<div class="col-md-12">
				<div class="panel panel-default">
					<div class="panel-body">
						{{#if eq type "notice"}}
							<div class="first">
							<img class="icon" src='{{GeoPattern "Mr Davey"}}'>
							</div>
							<div class="after">
								<b>{{username userId}}</b>
								{{#if text}}
									<br>
									{{text}}
								{{/if}}
								{{#if images}}
									<br>
									<div class="images">
									{{#each images}}
										<div class="notice-image">
										<div class="notice-link">{{title}}<!--&#9662;--></div>
										<img src="{{data}}" class="notice-image" width="200px">	
										<div class="info">4KB, JPEG, 2000x3000</div>
										</div>
									{{/each}}
									</div>
								{{/if}}
								{{#if youtubes}}
									<br>
									{{#each youtubes}}
									<div class="notice-embed">
										<div class="info">YouTube</div>
										<div class="notice-link"><a href="youtube.com/watch?v={{id}}">{{title}}</a></div>
										<img src="https://img.youtube.com/vi/{{id}}/0.jpg" width="300px">
									</div>
									{{/each}}
								{{/if}}
							</div>
						{{/if}}
						{{#if eq type "poll"}}
							<div class="poll">
							<b>Poll</b>
							<br>
							{{text}}
							<br>
							{{#if admin}}
								{{#if eq voted.length 0}}
									<div class="info">Nobody has submitted this poll yet.</div>
								{{else}}
									<br>	
									{{#each pollOptions}}
										{{title}}
										<div class="progress progress-info active">
											<div class="progress-bar" style="width: {{percent votes ../voted.length}}%;"></div>
										</div>		
									{{/each}}
								{{/if}}
							{{else}}
							{{#if contain voted currentUser._id}}
								{{#each pollOptions}}
									<input type="radio" name="{{../_id}}" disabled value="{{title}}">
									{{title}}
									<br>
								{{/each}}
								<button class="btn btn-default btn-sm poll-submit" disabled>Submit</button>
								<div class="info">Poll already submitted.</div>
							{{else}}
								{{#each pollOptions}}
									<input type="radio" name="{{../_id}}" value="{{title}}">
									{{title}}
									<br>
								{{/each}}
								<button class="btn btn-default btn-sm poll-submit">Submit</button>
							{{/if}}
							{{/if}}
							</div>
						{{/if}}
						{{#if eq type "reminder"}}
							<b>Reminder</b>
							<br>
							{{text}}
							<br>
							<span class="info">{{fullDate eventDate}}</span>
						{{/if}}
						{{#if eq type "assignment"}}
							<b>Assignment</b>
							<br>
							{{text}}
							<br>
							<span class="info">Due on {{fullDate deadline}}</span>	
							<br>
							{{#if uploadViaPandora}}
								{{#if teacher}}
									<div class="stat">
										<div class="stat-number">
											{{uploads.length}}
										</div>
										<div class="stat-title">
											Submitted
										</div>
									</div>	
									<div class="stat">
										<div class="stat-number">
											{{notDone}}
										</div>
										<div class="stat-title">
											Not Submitted
										</div>
									</div>
									<br>
									<a href="/rooms/{{../_id}}/notices/assignments/{{_id}}">See All</a>
								{{else}}
									{{#if eq fff.files.length 0}}
										<button class="btn btn-sm btn-default hand-in">Hand in</button>
									{{else}}
										<br>
										<table class="table table-bordered">
											<thead>
												<tr>
													<th>Filename</th>
												</tr>
											</thead>
											<tbody>
												{{#each fff.files}}
													{{#with FS.GetFile "files" .}}
														<tr>
															<td>
																{{this.name}}
																{{> FS.DeleteButton class="btn btn-danger btn-xs pull-right"}}
															</td>
														</tr>
													{{/with}}
												{{/each}}
											</tbody>	
										</table>	
										{{#if ne fff.files.length 4}}
											<button class="btn btn-sm btn-default hand-in">Upload More Files</button>
										{{/if}}
										{{#if fff.grade}}
											<br>
										{{else}}
											{{#if fff.comment}}
											<br>
											{{/if}}
										{{/if}}
										{{#if fff.grade}}
											<br>
											<div>
												<strong>Grade</strong><br>
												{{fff.grade}}
											</div>
										{{/if}}
										{{#if fff.comment}}
											<br>
											<div>
												<strong>Comment</strong><br>
												{{fff.comment}}	
											</div>	
										{{/if}}
									{{/if}}
								{{/if}}
							{{/if}}
						{{/if}}
					</div>
					{{#if tooManyComments}}
						<div class="panel-body panel-reply-plus-plus panel-reply-plus panel-reply">
							<button class="btn btn-link show-all">
							{{#if showAll}}	
								Hide Comments
							{{else}}
								Show More Comments
							{{/if}}
							</button>
						</div>
					{{/if}}
					{{#each commentsF}}
						<div class="panel-body panel-reply-plus panel-reply">
							<div class="first">
								<img class="icon" src='{{GeoPattern "HeyHeyYouYou"}}'>
							</div>
							<div class="after">
								<b>{{username userId}}</b> <span class="info">said {{fullDate date}}</span>
								{{#if activeComment ../type ../_id commentId}}
									<textarea class="form-control edit-reply-field">{{text}}</textarea>	
								{{else}}
									{{#if eq currentUser._id userId}}
										<div class="pull-right">
											<div class="bit-d edit-reply" data-id="{{../_id}}" data-type="{{../type}}">Edit</div>
											<div class="bit-d del-reply" data-id="{{../_id}}" data-type="{{../type}}">Delete</div>
										</div>
									{{/if}}
									<br>
									{{text}}
								{{/if}}
							</div>	
						</div>
					{{/each}}
					{{#if eq activeNotice _id}}
						<div class="panel-body panel-reply">
							<div class="input-group">
								<textarea class="form-control reply-text" rows="1"></textarea>
								<span class="input-group-addon btn btn-primary submit-reply">Submit</span>
								<span class="input-group-addon btn btn-default cancel-reply"><i class="fa fa-times"></i></span>
							</div>
						</div>
					{{/if}}
					<div class="panel-footer">
						<button class="btn btn-link reply">Reply</button>
						{{#if teacher}}
							{{#if ne type "poll"}}
								{{#if eq type "notice"}}
									<a href="/rooms/{{../_id}}/notices/announcements/{{_id}}/edit" class="btn btn-link">Edit</a>
								{{/if}}
								{{#if eq type "reminder"}}									
									<a href="/rooms/{{../_id}}/notices/reminders/{{_id}}/edit" class="btn btn-link">Edit</a>
								{{/if}}
								{{#if eq type "assignment"}}
									<a href="/rooms/{{../_id}}/notices/assignments/{{_id}}/edit" class="btn btn-link">Edit</a>
								{{/if}}
							{{/if}}
							<button class="btn btn-link del">Delete</button>
						{{/if}}
						<div class="pull-right">
							{{fullDate date}}
						</div>
					</div>
				</div>
			</div>
		{{/each}}
		</div>
	</div>
</template>

<template name="assignment">
	{{>navigation}}
	<div class="container">
		<div class="col-md-3">
			{{>noticeNav}}
		</div>
		<div class="col-md-9">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">
						Upload
						<div class="pull-right">
							<a href="/rooms/{{_id}}"><i class="fa fa-times"></i></a>
						</div>
					</h3>	
				</div>
				<div class="panel-body">
					<table class="table">
						<thead>
							<tr>
								<th>User</th>
								<th>Files</th>
								<th>Feedback</th>
							</tr>
						</thead>
						<tbody>
						{{#if uploads}}
							{{#each uploads}}
								<tr>
									<td>{{username2 userId}}</td>
									<td>
										{{#each files}}
											{{#with FS.GetFile "files" .}}
												<a href="{{this.url}}">{{this.name}}</a><br>	
											{{/with}}
										{{/each}}
									</td>
									<td>
										{{#if feedback}}
											<button class="btn btn-default btn-sm open-feedback">Change</button>	
										{{else}}
											<button class="btn btn-default btn-sm open-feedback">Give</button>
										{{/if}}
									</td>
								</tr>
							{{/each}}
						{{else}}
							Nobody has uploaded anything yet.
						{{/if}}
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</template>

<template name="feedback">
	<div class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title">Feedback</h4>
				</div>
				<div class="modal-body">
					<div class="form-group">
						<label>Grade</label>
						<input type="text" value="{{grade}}" class="form-control grade">
					</div>
					<div class="form-group">
						<label>Comment</label>
						<textarea class="form-control comment">{{comment}}</textarea>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary save">Save</button>
				</div>
			</div>
		</div>
	</div>
</template>

<template name="createPoll">
	{{>navigation}}
	<div class="container">
		<div class="row">
			<div class="col-md-3">
				{{>noticeNav}}
			</div>
			<div class="col-md-9">
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title">
							Create Poll
							<div class="pull-right">
								<a href="/rooms/{{_id}}"><i class="fa fa-times"></i></a>
							</div>
						</h3>
					</div>
					<div class="panel-body">
						<form>
							<div class="form-group">
								<label>Title</label>
								<input type="text" class="form-control text">
							</div>
							<div class="form-group">
								<label>Options</label>
								<br>
								{{>pollOption}}
								{{>pollOption}}
								<div class="add-option">
									<input type="text" class="form-control" placeholder="Add option" disabled>
								</div>
							</div>
							{{#if error}}
								<div class="error-msg text-danger">
									<strong>{{error}}</strong>
								</div>	
							{{/if}}
							<button type="button" class="btn btn-primary submit">Submit</button>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
</template>

<template name="login">
	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#">Pandora</a>
			</div>
			<div class="navbar-collapse collapse">
				<ul class="nav navbar-nav navbar-right">
					<li><a href="#">About</a></li>
				</ul>
			</div>
		</div>
	</nav>
	<div class="row">
		<div class="col-md-4 col-sm-12 col-md-push-4">
			<div class="well login-container">
        <h2 class="text-center school-title">Westcliff High School for Boys</h2>
        <p class="text-center login-info">
          Enter your <b>username</b> and <b>password</b>.
        </p>
        <br>
				<form>
					<div class="form-group">
						<input type="text" placeholder="Username" class="username form-control input-lg">
					</div>
					<div class="form-group">
						<input type="password" placeholder="Password" class="password form-control input-lg">
					</div>
					<button type="button" class="btn btn-success btn-block btn-lg login-button">
            <i class="fa fa-lock"></i>
            Login
          </button>
				</form>
			</div>
		</div>
	</div>
</template>

<template name="adminOnly">
	<div style="width: 600px; margin: 0 auto; padding: 20px;">
    <div style="font-size: 18pt; color: #999; text-align:center;">
			This route is restricted to admins.
    </div>
  </div>
</template>
